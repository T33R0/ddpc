# Current RLS Policies

**Last Updated**: Most current database state

| schemaname | tablename             | policyname                                                | permissive | cmd    | qual                                                                                                                                                                                                                | with_check                                                                                                                                                                                                          |
| ---------- | --------------------- | --------------------------------------------------------- | ---------- | ------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| public     | fuel_log              | Enable all access for authenticated users (own fuel logs) | PERMISSIVE | ALL    | (auth.uid() = user_id)                                                                                                                                                                                              | (auth.uid() = user_id)                                                                                                                                                                                              |
| public     | maintenance_log       | maintenance_log_owner_all                                 | PERMISSIVE | ALL    | (EXISTS ( SELECT 1
   FROM user_vehicle uv
  WHERE ((uv.id = maintenance_log.user_vehicle_id) AND (uv.owner_id = auth.uid()))))                                                                                     | (EXISTS ( SELECT 1
   FROM user_vehicle uv
  WHERE ((uv.id = maintenance_log.user_vehicle_id) AND (uv.owner_id = auth.uid()))))                                                                                     |
| public     | master_parts_list     | Allow public read access                                  | PERMISSIVE | SELECT | true                                                                                                                                                                                                                | null                                                                                                                                                                                                                |
| public     | mod_categories        | Allow public read access                                  | PERMISSIVE | SELECT | true                                                                                                                                                                                                                | null                                                                                                                                                                                                                |
| public     | mod_items             | Allow public read access                                  | PERMISSIVE | SELECT | true                                                                                                                                                                                                                | null                                                                                                                                                                                                                |
| public     | mod_outcome           | mod_outcome_owner_all                                     | PERMISSIVE | ALL    | (EXISTS ( SELECT 1
   FROM (mods m
     JOIN user_vehicle uv ON ((uv.id = m.user_vehicle_id)))
  WHERE ((m.id = mod_outcome.mod_id) AND (uv.owner_id = auth.uid()))))                                               | (EXISTS ( SELECT 1
   FROM (mods m
     JOIN user_vehicle uv ON ((uv.id = m.user_vehicle_id)))
  WHERE ((m.id = mod_outcome.mod_id) AND (uv.owner_id = auth.uid()))))                                               |
| public     | mod_parts             | Enable all access for authenticated users (own mod parts) | PERMISSIVE | ALL    | (EXISTS ( SELECT 1
   FROM (mods m
     JOIN user_vehicle uv ON ((m.user_vehicle_id = uv.id)))
  WHERE ((m.id = mod_parts.mod_id) AND (uv.owner_id = auth.uid()))))                                                 | (EXISTS ( SELECT 1
   FROM (mods m
     JOIN user_vehicle uv ON ((m.user_vehicle_id = uv.id)))
  WHERE ((m.id = mod_parts.mod_id) AND (uv.owner_id = auth.uid()))))                                                 |
| public     | mods                  | mods_owner_all                                            | PERMISSIVE | ALL    | (EXISTS ( SELECT 1
   FROM user_vehicle uv
  WHERE ((uv.id = mods.user_vehicle_id) AND (uv.owner_id = auth.uid()))))                                                                                                | (EXISTS ( SELECT 1
   FROM user_vehicle uv
  WHERE ((uv.id = mods.user_vehicle_id) AND (uv.owner_id = auth.uid()))))                                                                                                |
| public     | odometer_log          | odolog_owner_all                                          | PERMISSIVE | ALL    | (EXISTS ( SELECT 1
   FROM user_vehicle uv
  WHERE ((uv.id = odometer_log.user_vehicle_id) AND (uv.owner_id = auth.uid()))))                                                                                        | (EXISTS ( SELECT 1
   FROM user_vehicle uv
  WHERE ((uv.id = odometer_log.user_vehicle_id) AND (uv.owner_id = auth.uid()))))                                                                                        |
| public     | part_inventory        | Enable all access for authenticated users (own parts)     | PERMISSIVE | ALL    | (auth.uid() = user_id)                                                                                                                                                                                              | (auth.uid() = user_id)                                                                                                                                                                                              |
| public     | service_categories    | Allow public read access                                  | PERMISSIVE | SELECT | true                                                                                                                                                                                                                | null                                                                                                                                                                                                                |
| public     | service_intervals     | Enable all access for authenticated users (own intervals) | PERMISSIVE | ALL    | (auth.uid() = user_id)                                                                                                                                                                                              | (auth.uid() = user_id)                                                                                                                                                                                              |
| public     | service_items         | Allow public read access                                  | PERMISSIVE | SELECT | true                                                                                                                                                                                                                | null                                                                                                                                                                                                                |
| public     | user_profile          | up_insert_self                                            | PERMISSIVE | INSERT | null                                                                                                                                                                                                                | (auth.uid() = user_id)                                                                                                                                                                                              |
| public     | user_profile          | up_read_public                                            | PERMISSIVE | SELECT | (is_public = true)                                                                                                                                                                                                  | null                                                                                                                                                                                                                |
| public     | user_profile          | up_read_self                                              | PERMISSIVE | SELECT | (auth.uid() = user_id)                                                                                                                                                                                              | null                                                                                                                                                                                                                |
| public     | user_profile          | up_select_self                                            | PERMISSIVE | SELECT | (auth.uid() = user_id)                                                                                                                                                                                              | null                                                                                                                                                                                                                |
| public     | user_profile          | up_service_all                                            | PERMISSIVE | ALL    | (auth.role() = 'service_role'::text)                                                                                                                                                                                | (auth.role() = 'service_role'::text)                                                                                                                                                                                |
| public     | user_profile          | up_update_admin                                           | PERMISSIVE | UPDATE | (((auth.jwt() ->> 'role'::text) = 'service_role'::text) OR (EXISTS ( SELECT 1
   FROM user_profile user_profile_1
  WHERE ((user_profile_1.user_id = auth.uid()) AND (user_profile_1.role = 'admin'::user_role))))) | (((auth.jwt() ->> 'role'::text) = 'service_role'::text) OR (EXISTS ( SELECT 1
   FROM user_profile user_profile_1
  WHERE ((user_profile_1.user_id = auth.uid()) AND (user_profile_1.role = 'admin'::user_role))))) |
| public     | user_profile          | up_update_self                                            | PERMISSIVE | UPDATE | (auth.uid() = user_id)                                                                                                                                                                                              | (auth.uid() = user_id)                                                                                                                                                                                              |
| public     | user_profile          | zz_combined_select                                        | PERMISSIVE | SELECT | ((( SELECT auth.uid() AS uid) = user_id) OR (is_public = true))                                                                                                                                                     | null                                                                                                                                                                                                                |
| public     | user_vehicle          | Users can manage their own vehicles                       | PERMISSIVE | ALL    | (owner_id = auth.uid())                                                                                                                                                                                             | null                                                                                                                                                                                                                |
| public     | user_vehicle          | Users can view their own vehicles                         | PERMISSIVE | SELECT | (owner_id = auth.uid())                                                                                                                                                                                             | null                                                                                                                                                                                                                |
| public     | user_vehicle          | public read vehicles with privacy=public                  | PERMISSIVE | SELECT | (privacy = 'public'::text)                                                                                                                                                                                          | null                                                                                                                                                                                                                |
| public     | user_vehicle          | vehicle_select_public                                     | PERMISSIVE | SELECT | (privacy = 'public'::text)                                                                                                                                                                                          | null                                                                                                                                                                                                                |
| public     | vehicle_data          | read vehicle_data                                         | PERMISSIVE | SELECT | true                                                                                                                                                                                                                | null                                                                                                                                                                                                                |
| public     | vehicle_data          | vd_read                                                   | PERMISSIVE | SELECT | true                                                                                                                                                                                                                | null                                                                                                                                                                                                                |
| public     | vehicle_image_archive | via_delete_service_only                                   | PERMISSIVE | DELETE | (auth.role() = 'service_role'::text)                                                                                                                                                                                | null                                                                                                                                                                                                                |
| public     | vehicle_image_archive | via_insert_service_only                                   | PERMISSIVE | INSERT | null                                                                                                                                                                                                                | (auth.role() = 'service_role'::text)                                                                                                                                                                                |
| public     | vehicle_image_archive | via_select_public                                         | PERMISSIVE | SELECT | true                                                                                                                                                                                                                | null                                                                                                                                                                                                                |
| public     | vehicle_image_archive | via_update_service_only                                   | PERMISSIVE | UPDATE | (auth.role() = 'service_role'::text)                                                                                                                                                                                | (auth.role() = 'service_role'::text)                                                                                                                                                                                |
| public     | vehicle_primary_image | vpi_delete_service_only                                   | PERMISSIVE | DELETE | (auth.role() = 'service_role'::text)                                                                                                                                                                                | null                                                                                                                                                                                                                |
| public     | vehicle_primary_image | vpi_insert_service_only                                   | PERMISSIVE | INSERT | null                                                                                                                                                                                                                | (auth.role() = 'service_role'::text)                                                                                                                                                                                |
| public     | vehicle_primary_image | vpi_select_public                                         | PERMISSIVE | SELECT | true                                                                                                                                                                                                                | null                                                                                                                                                                                                                |
| public     | vehicle_primary_image | vpi_update_service_only                                   | PERMISSIVE | UPDATE | (auth.role() = 'service_role'::text)                                                                                                                                                                                | (auth.role() = 'service_role'::text)                                                                                                                                                                                |
| public     | vehicle_url_queue     | vuq_service_only_all                                      | PERMISSIVE | ALL    | (auth.role() = 'service_role'::text)                                                                                                                                                                                | (auth.role() = 'service_role'::text)                                                                                                                                                                                |

## Notes
- **FUEL_LOG**: Users can only access their own fuel logs
- **MAINTENANCE_LOG**: Users can only access maintenance logs for vehicles they own
- **MASTER TABLES**: Public read access for parts list, mod categories, mod items, service categories, and service items
- **MOD_OUTCOME**: Users can only access outcomes for mods on vehicles they own
- **MOD_PARTS**: Users can only access parts for mods on vehicles they own
- **ODOMETER_LOG**: Users can only access odometer logs for vehicles they own
- **PART_INVENTORY**: Users can only access their own parts inventory
- **SERVICE_INTERVALS**: Users can only access their own service intervals
- **USER VEHICLES**: Direct ownership-based access (owner_id = auth.uid())
- **PUBLIC ACCESS**: Vehicles with privacy='public' can be viewed by anyone
- **SERVICE OPERATIONS**: Service role has full access to system tables
