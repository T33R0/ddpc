# Current RLS Policies

**Last Updated**: Most current database state - simplified direct ownership system

| schemaname | tablename    | policyname                               | permissive | cmd    | qual                                                                                                                                                                                                                | with_check                                                                                                                                                                                                                                                                                                              |
| ---------- | ------------ | ---------------------------------------- | ---------- | ------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| public     | user_profile | up_insert_self                           | PERMISSIVE | INSERT | null                                                                                                                                                                                                                | ((auth.uid() = user_id) AND (role = 'user'::user_role) AND (plan = 'free'::text) AND (NOT is_user_banned(auth.uid())))                                                                                                                                                                                                  |
| public     | user_profile | up_read_public                           | PERMISSIVE | SELECT | (is_public = true)                                                                                                                                                                                                  | null                                                                                                                                                                                                                                                                                                                    |
| public     | user_profile | up_read_self                             | PERMISSIVE | SELECT | (auth.uid() = user_id)                                                                                                                                                                                              | null                                                                                                                                                                                                                                                                                                                    |
| public     | user_profile | up_update_admin                          | PERMISSIVE | UPDATE | (((auth.jwt() ->> 'role'::text) = 'service_role'::text) OR (EXISTS ( SELECT 1
   FROM user_profile user_profile_1
  WHERE ((user_profile_1.user_id = auth.uid()) AND (user_profile_1.role = 'admin'::user_role))))) | (((auth.jwt() ->> 'role'::text) = 'service_role'::text) OR (EXISTS ( SELECT 1
   FROM user_profile user_profile_1
  WHERE ((user_profile_1.user_id = auth.uid()) AND (user_profile_1.role = 'admin'::user_role)))))                                                                                                     |
| public     | user_profile | up_update_self                           | PERMISSIVE | UPDATE | ((auth.uid() = user_id) AND (NOT is_user_banned(auth.uid())))                                                                                                                                                       | ((auth.uid() = user_id) AND (NOT is_user_banned(auth.uid())) AND (role = ( SELECT user_profile_1.role
   FROM user_profile user_profile_1
  WHERE (user_profile_1.user_id = auth.uid()))) AND (plan = ( SELECT user_profile_1.plan
   FROM user_profile user_profile_1
  WHERE (user_profile_1.user_id = auth.uid())))) |
| public     | user_profile | zz_combined_select                       | PERMISSIVE | SELECT | ((( SELECT auth.uid() AS uid) = user_id) OR (is_public = true))                                                                                                                                                     | null                                                                                                                                                                                                                                                                                                                    |
| public     | user_vehicle | Users can manage their own vehicles      | PERMISSIVE | ALL    | (owner_id = auth.uid())                                                                                                                                                                                             | null                                                                                                                                                                                                                                                                                                                    |
| public     | user_vehicle | Users can view their own vehicles        | PERMISSIVE | SELECT | (owner_id = auth.uid())                                                                                                                                                                                             | null                                                                                                                                                                                                                                                                                                                    |
| public     | user_vehicle | public read vehicles with privacy=public | PERMISSIVE | SELECT | (privacy = 'public'::text)                                                                                                                                                                                          | null                                                                                                                                                                                                                                                                                                                    |
| public     | user_vehicle | vehicle_select_public                    | PERMISSIVE | SELECT | (privacy = 'public'::text)                                                                                                                                                                                          | null                                                                                                                                                                                                                                                                                                                    |
| public     | vehicle_data | read vehicle_data                        | PERMISSIVE | SELECT | true                                                                                                                                                                                                                | null                                                                                                                                                                                                                                                                                                                    |
| public     | vehicle_data | vd_read                                  | PERMISSIVE | SELECT | true                                                                                                                                                                                                                | null                                                                                                                                                                                                                                                                                                                    |

## Notes
- **FINAL STATE**: Complete rebuild with direct user-to-vehicle ownership
- **REMOVED**: All garage/garage_member/event/event_part/part tables and policies
- **SIMPLIFIED**: Direct `owner_id` checks eliminate all recursion issues
- **PERFECT FLOW**: Clean, working vehicle collection system
